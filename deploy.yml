# .github/workflows/deploy.yml

name: Three.js Static Site CI/CD

# 1. Trigger: Run on every push to the main branch
on:
  push:
    branches:
      - main
  # Optional: Allows manual runs from the GitHub Actions tab
  workflow_dispatch:

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest # A fresh virtual server for building

    steps:
      - name: â¬‡ï¸ Checkout Repository
        # Downloads your source code from GitHub
        uses: actions/checkout@v4
     
      # --- Bundler/NPM Setup ---
      - name: ğŸ› ï¸ Setup Node.js Environment
        # Installs Node.js to run your npm commands
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm' # Speeds up future installs by caching node_modules

      - name: ğŸ“¥ Install Dependencies (via npm)
        # Downloads all packages listed in package.json
        run: npm install

      - name: ğŸ—ï¸ Run Bundler Build (Creates the 'dist' folder)
        # This executes your custom build script (e.g., webpack, vite, etc.)
        run: npm run build
       
      # --- Deployment Step ---
      - name: ğŸš€ Deploy Static Site (Example: GitHub Pages)
        # This action takes the generated static files and pushes them to your hosting platform.
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          # CRITICAL: This points the deployment tool to the folder created by your bundler.
          publish_dir: ./dist
          # Ensure your deployment branch is set correctly (e.g., gh-pages, or main if deploying to root)
          publish_branch: gh-pages
